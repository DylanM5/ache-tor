global
    maxconn 10000
    log stdout format raw local0

defaults
    mode http
    timeout connect 60s
    timeout client 120s
    timeout server 120s
    retries 3
    option redispatch
    log global

frontend tor_frontend
    bind *:8118
    default_backend tor_proxies

backend tor_proxies
    balance roundrobin
    option httpchk
    http-check send meth GET uri /
    
    # 8 Tor proxy backends with health checks
    server torproxy1 torproxy1:8118 check inter 30s fall 3 rise 2 maxconn 300
    server torproxy2 torproxy2:8118 check inter 30s fall 3 rise 2 maxconn 300
    server torproxy3 torproxy3:8118 check inter 30s fall 3 rise 2 maxconn 300
    server torproxy4 torproxy4:8118 check inter 30s fall 3 rise 2 maxconn 300
    server torproxy5 torproxy5:8118 check inter 30s fall 3 rise 2 maxconn 300
    server torproxy6 torproxy6:8118 check inter 30s fall 3 rise 2 maxconn 300
    server torproxy7 torproxy7:8118 check inter 30s fall 3 rise 2 maxconn 300
    server torproxy8 torproxy8:8118 check inter 30s fall 3 rise 2 maxconn 300

# Stats page (optional) - access at http://localhost:8404/stats
listen stats
    bind *:8404
    stats enable
    stats uri /stats
    stats refresh 10s
